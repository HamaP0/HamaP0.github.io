---
layout: default
---
<article class="post">
  <header class="post-header">
    <h1 class="post-title">{{ page.title | escape }}</h1>
    <p class="post-meta">
      작성일: {{ page.date | date: "%Y년 %m월 %d일" }}
      {% if page.categories.size > 0 %}
        • 카테고리: {{ page.categories | join: ', ' }}
      {% endif %}
    </p>
  </header>

  <div class="post-content">
    {{ content }}
  </div>
</article>

<hr>

<nav class="post-nav" aria-label="이전·다음 글">
  {% comment %}
    1. 이 글의 카테고리 목록을 가져옵니다. 
       - 'primary_category'가 지정되어 있으면 그것을 사용합니다.
       - 없으면 'categories'의 첫 번째 카테고리를 사용합니다.
       - 둘 다 없으면 전체 글('site.posts')에서 이전/다음 글을 찾습니다.
  {% endcomment %}
  {% assign category_name = page.primary_category | default: page.categories.first %}
  {% assign posts_list = site.posts %}
  {% if category_name %}
    {% assign posts_list = site.categories[category_name] %}
  {% endif %}

  {% assign posts_list_sorted = posts_list | sort: 'date' %}

  {% comment %}
    2. 정렬된 목록에서 현재 글의 위치(index)를 찾고 이전/다음 글을 변수에 할당합니다.
       - 'map'과 'index_of' 필터 대신 for-loop를 사용해 안정적으로 찾습니다.
  {% endcomment %}
  {% for post in posts_list_sorted %}
    {% if post.url == page.url %}
      {% assign current_post_index = forloop.index0 %}
      {% assign prev_post_index = current_post_index | minus: 1 %}
      {% assign next_post_index = current_post_index | plus: 1 %}

      {% if prev_post_index >= 0 %}
        {% assign prev_post = posts_list_sorted[prev_post_index] %}
      {% endif %}
      
      {% if next_post_index < posts_list_sorted.size %}
        {% assign next_post = posts_list_sorted[next_post_index] %}
      {% endif %}
      {% break %}
    {% endif %}
  {% endfor %}

  {% comment %}
    3. 할당된 이전/다음 글이 있으면 링크를 표시합니다.
       - 카테고리 내에 글이 하나뿐이라 이전/다음 글이 없는 경우,
         사이트 전체의 이전/다음 글(page.previous, page.next)을 사용합니다.
  {% endcomment %}
  {% if prev_post %}
    <a class="prev" href="{{ prev_post.url | relative_url }}">
      « 이전 글: {{ prev_post.title | escape }}
    </a>
  {% elsif page.previous %}
     <a class="prev" href="{{ page.previous.url | relative_url }}">
        « 이전 글: {{ page.previous.title | escape }}
      </a>
  {% endif %}

  {% if next_post %}
    <a class="next" href="{{ next_post.url | relative_url }}">
      다음 글: {{ next_post.title | escape }} »
    </a>
  {% elsif page.next %}
    <a class="next" href="{{ page.next.url | relative_url }}">
        다음 글: {{ page.next.title | escape }} »
    </a>
  {% endif %}
</nav>
