---
layout: default
---
<!-- _layouts/post.html -->
<article class="post">
  <header class="post-header">
    <h1 class="post-title">{{ page.title | escape }}</h1>
    <p class="post-meta">
      작성일: {{ page.date | date: "%Y년 %m월 %d일" }}
      {% if page.categories.size > 0 %}
        • 카테고리: {{ page.categories | join: ', ' }}
      {% endif %}
    </p>
  </header>

  <div class="post-content">
    {{ content }}
  </div>

  {% comment %} ====================================================== {% endcomment %}
  {% comment %}    이전/다음 글 내비게이션 (오류 방지 로직 적용)        {% endcomment %}
  {% comment %} ====================================================== {% endcomment %}

  {%- comment -%}
    1. 탐색할 카테고리를 정합니다. YAML 머리말에 'primary_category'가 있으면 그것을 사용하고,
       없으면 첫 번째 카테고리를 사용합니다.
  {%- endcomment -%}
  {%- assign category_to_navigate = page.primary_category | default: page.categories.first -%}

  {%- if category_to_navigate -%}
    {%- comment -%}
      2. 해당 카테고리의 모든 글을 가져옵니다.
         [오류 수정] 카테고리가 비어있을 경우를 대비해 'default: []'로 오류를 방지하고,
         날짜순으로 정렬합니다.
    {%- endcomment -%}
    {%- assign posts_in_category = site.categories[category_to_navigate] | default: [] | sort: 'date' -%}

    {%- comment -%}
      3. 표준 'for' 루프를 사용해 현재 글의 순서(index)를 찾습니다.
         [오류 수정] 'index_of' 필터는 비표준이라 불안정하므로, 루프를 통해 직접 찾습니다.
    {%- endcomment -%}
    {%- for post_item in posts_in_category -%}
      {%- if post_item.url == page.url -%}
        {%- assign current_post_index = forloop.index0 -%}
        {%- break -%}
      {%- endif -%}
    {%- endfor -%}

    {%- comment -%}
      4. 현재 글의 순서를 찾았고, 카테고리에 2개 이상의 글이 있을 경우에만 내비게이션을 표시합니다.
    {%- endcomment -%}
    {%- if current_post_index and posts_in_category.size > 1 -%}
      <hr>
      <nav class="post-nav" aria-label="이전·다음 글">

        {%- comment -%} 이전 글 링크 (첫 번째 글이 아닐 경우) {%- endcomment -%}
        {%- if current_post_index > 0 -%}
          {%- assign prev_post_index = current_post_index | minus: 1 -%}
          {%- assign previous_post = posts_in_category[prev_post_index] -%}
          <a class="prev" href="{{ previous_post.url | relative_url }}">« 이전 글: {{ previous_post.title | escape }}</a>
        {%- endif -%}

        {%- comment -%} 다음 글 링크 (마지막 글이 아닐 경우) {%- endcomment -%}
        {%- if current_post_index < posts_in_category.size | minus: 1 -%}
          {%- assign next_post_index = current_post_index | plus: 1 -%}
          {%- assign next_post = posts_in_category[next_post_index] -%}
          <a class="next" href="{{ next_post.url | relative_url }}">다음 글: {{ next_post.title | escape }} »</a>
        {%- endif -%}

      </nav>
    {%- endif -%}
  {%- endif -%}
</article>
