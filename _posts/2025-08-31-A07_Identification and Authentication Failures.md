---
layout: post
title: "A07:2021 - Identification and Authentication Failures <br> (식별 및 인증 실패) 분석 보고서"
date: 2025-08-31 17:00:00 +0900
categories: Projects OWASP-Top-10
---
---

### **프로젝트 7. A07:2021 - Identification and Authentication Failures <br> (식별 및 인증 실패) 분석 보고서**

#### **1. 취약점 개요**

정확한 비밀번호를 입력해야 문이 열리는 것이 인증의 기본 원리입니다. 그런데 만약 이 도어락이 비밀번호를 수백 번 틀려도 아무런 경고 없이 계속 시도할 수 있게 허용하고, 로그인 성공 후 발급되는 열쇠(세션)를 너무나 쉽게 복제할 수 있도록 설계되었다면 어떨까요? **`식별 및 인증 실패`**란 바로 이처럼 사용자가 진짜 주인인지 확인하고, 그 인증 상태를 안전하게 유지하는 모든 과정에서 허점이 발생하는 문제를 의미합니다. 

단순히 로그인 보안이 뚫리는 문제뿐만 아니라, 취약한 암호 정책, 허술한 계정 복구 절차, 예측 가능한 세션 ID 발급 등 신원 확인 및 유지와 관련된 모든 취약점이 여기에 해당합니다. 이 보고서에서는 DVWA 환경의 여러 기능에 흩어져 있는 인증 관련 취약점들을 심층적으로 분석해 보았습니다.

---

#### **2. 시나리오 분석 및 재현**

**Part 1. 미리 파놓은 함정: 세션 고정 공격(Session Fixation)의 다층적 방어 메커니즘 분석**

*   **가설 설정:**
찜질방에 가서 내가 먼저 빈 락커 키`세션 ID`를 받은 뒤, 친구에게 "이 자리가 명당이야!"라며 그 키를 건네준다. 친구가 그 키로 자신의 회원증을 등록(로그인)하면, 나는 원래부터 알고 있던 그 락커 번호로 친구의 락커를 몰래 열어볼 수 있을 것이다. 이 가설을 검증하기 위해, URL에 세션 ID를 주입하는 고전적인 세션 고정 공격을 시도했다.

*   **분석 및 검증:**
이번 분석에서는 DVWA 환경에서 세션 고정 공격을 시도하고, 최신 웹 환경에 내장된 다층적인 방어 메커니즘을 심층적으로 추적했습니다.

1.  **1차 방어 메커니즘 분석 (서버 설정):**
    최초 공격 시도 시, URL에 주입한 세션 ID가 무시되고 서버에서 새로운 세션 ID를 발급하는 현상을 확인했습니다. 원인 분석을 위해 SSH를 통해 우분투 서버에 접근하여 PHP 8.3 환경의 `phpinfo`를 확인한 결과, 아래와 같이 URL을 통한 세션 ID 주입을 원천적으로 차단하는 `session.use_only_cookies`와 `session.use_strict_mode` 설정이 기본값`On`으로 활성화되어 있음을 발견했습니다. 이것이 공격 실패의 근본적인 1차 원인이었습니다.

    ![PHP 기본 보안 설정](/assets/images/A07_P1-1.png)

2.  **서버 레벨 방어 우회 (php.ini 수정):**
    원인 분석을 바탕으로, `/etc/php/8.3/apache2/php.ini` 설정 파일의 `session.use_only_cookies`와 `session.use_strict_mode` 값을 모두 `0(Off)`으로 수정한 뒤 Apache 서버를 재시작했습니다. 아래 화면은 해당 설정 변경이 서버에 성공적으로 적용되어 1차 방어선이 비활성화되었음을 보여줍니다.

    ![PHP 보안 설정 비활성화](/assets/images/A07_P1-2.png)

3.  **2차 방어 메커니즘 분석 (브라우저 쿠키):**
    서버 방어선을 우회한 후 재시도했으나 여전히 공격이 실패했습니다. 다음 화면과 같이, 피해자 브라우저에 이미 유효한 세션 쿠키가 존재할 경우 브라우저는 URL의 세션 값보다 기존 쿠키를 우선하여 서버에 전송함을 확인했습니다. 이는 브라우저의 동작 특성에 기반한 2차 방어선으로 작용했습니다.

    ![브라우저의 기존 쿠키 우선 정책](/assets/images/A07_P1-3.png)

4.  **최종 방어 메커니즘 확인 (애플리케이션 코드):**
    피해자 브라우저의 쿠키를 모두 삭제하여 2차 방어선까지 우회한 뒤 최종 공격을 시도했습니다. 하지만 최종 시도 결과에서 보듯이, 서버는 공격자가 의도한 세션 ID`6mlah...`를 받아들이지 않고, 완전히 새로운 세션 ID`eg5ba...`를 강제로 발급했습니다. 이는 `php.ini` 설정과 브라우저 상태를 모두 제어했음에도 불구하고, DVWA 애플리케이션의 소스 코드 레벨에서 `session_regenerate_id()`와 같은 함수를 통해 세션을 무조건 재발급하는 강력한 최종 방어 로직이 동작하고 있음을 의미합니다.

    ![애플리케이션 레벨의 강제 세션 재발급](/assets/images/A07_P1-4.png)

*   **위험성 분석 및 결론:**
세션 고정 공격은 성공 시 비밀번호 없이도 사용자의 인증된 세션을 탈취할 수 있는 심각한 위협입니다. 하지만 이번 분석을 통해 최신 웹 환경은 **① PHP 엔진의 기본 보안 설정, ② 브라우저의 쿠키 정책, ③ 애플리케이션 자체의 방어 코드**라는 다층적 방어 체계를 통해 이러한 공격을 효과적으로 무력화하고 있음을 증명했습니다. 단순 공격 성공 여부를 넘어, 실패의 원인을 서버와 코드 레벨까지 추적하고 분석하는 과정을 통해 견고한 인증 시스템의 구성 요소를 이해할 수 있었습니다.

**Part 2. 복제된 열쇠: 취약한 세션 관리**

*   **가설 설정:**
성공적인 인증 후 발급되는 `세션 ID`가 만약 예측 가능한 규칙을 가지고 있다면, 공격자는 다른 사용자의 세션 ID를 추측하여 인증 절차를 건너뛰고 계정을 탈취(세션 하이재킹)할 수 있을 것이다.

*   **분석 및 검증:**
로그인 성공 '이후', 사용자의 인증 상태를 안전하게 유지하는 세션 관리의 취약점을 분석했습니다. `A02: 암호화 실패` 보고서에서 확인했듯이, 이 시스템의 세션 ID는 암호학적으로 안전한 난수가 아닌, 1, 2, 3... 으로 순차적으로 증가하는 단순 정수로 생성되는 근본적인 문제를 가지고 있습니다.

인증 유지의 관점에서 이 문제를 보면, 공격자는 현재 접속해 있는 다른 사용자의 세션 ID를 매우 쉽게 추측할 수 있게 됩니다. 이는 성공적으로 인증을 마친 사용자의 출입증(세션 쿠키)을 위조하여 그 사람 행세를 하는 **`세션 하이재킹`** 공격으로 이어집니다. 결국, 아무리 강력한 비밀번호로 인증을 통과했더라도, 그 인증 상태 자체를 도둑맞아 인증 시스템 전체가 무력화될 수 있습니다.

   ![1](/assets/images/A02_P1-1.png)
   ![2](/assets/images/A02_P1-2.png)
   ![3](/assets/images/A02_P1-3.png)

*   **위험성 분석:**
예측 가능한 세션 ID는 공격자가 비밀번호를 몰라도 사용자의 계정을 탈취할 수 있게 만드는 치명적인 취약점입니다. 공격자는 탈취한 세션으로 사용자의 모든 활동을 수행할 수 있으며, 사용자는 자신의 계정이 탈취되었다는 사실조차 인지하기 어렵습니다.

**Part 3. 허술한 뒷문: 안전하지 않은 계정 복구**

*   **가설 설정:**
비밀번호를 잊었을 때 이용하는 '계정 복구' 기능이 만약 사회 공학적으로 유추하기 쉬운 정보에 의존한다면, 공격자는 이를 우회하여 합법적인 절차처럼 계정의 소유권을 이전받을 수 있을 것이다.

*   **분석:**
DVWA에는 해당 기능이 없지만, 실제 서비스에서 가장 심각한 인증 실패는 종종 '계정 복구' 과정에서 발생합니다. 아래는 인터넷에서 쉽게 찾아볼 수 있는, 사회 공학적 공격에 취약한 본인 확인 질문의 예시입니다.

   ![취약한 인증](/assets/images/A07_P3-1.png)

이처럼 '어머니의 성함', '졸업한 초등학교 이름' 등은 SNS나 주변인 탐문 등 약간의 노력만으로도 공격자가 충분히 알아낼 수 있는 정보입니다. 아래의 흐름도처럼, 이러한 정보에만 의존하는 복구 절차는 인증 시스템의 치명적인 뒷문이 됩니다.

   ![안전하지 않은 흐름도](/assets/images/A07_P3-3.png)


*   **위험성 분석:**
안전하지 않은 계정 복구는 MFA와 같은 강력한 인증 체계를 모두 우회하고 계정을 탈취할 수 있는 심각한 위협입니다. 이를 해결하기 위해서는 반드시 아래와 같이 이메일, SMS 등 사용자가 실제로 소유하고 있는 다른 채널을 통한 **`2차 인증`**(Out-of-Band Authentication)을 거쳐야만 합니다.

   ![2차 인증](/assets/images/A07_P3-2.png)
   ![안전한 흐름도](/assets/images/A07_P3-4.png)

---

#### **3. 근본 원인 및 해결 방안**

*   **원인: 단일 실패 지점 (Single Point of Failure)**

위 세 가지 문제의 공통적인 원인은, 인증 과정을 여러 겹으로 보호하는 심층 방어 전략 없이 단 하나의 방어선(비밀번호)에만 의존했기 때문입니다. 비밀번호 추측을 막는 장치도, 인증 상태를 지키는 장치도, 비상시를 위한 복구 절차도 모두 허술했습니다.

*   **해결 방안: 심층 방어 기반의 인증 체계 구축**

안전한 인증 체계를 구축하기 위해서는 여러 방어 계층을 겹겹이 쌓는 것이 필수적입니다. NIST(미국 국립표준기술연구소)의 `Digital Identity Guidelines` (SP 800-63B) 와 같은 국제 표준을 준수하여 다음과 같은 다중 방어 전략을 구현해야 합니다.

1.  **강력한 패스워드 정책:** '최소 8자, 특수문자 포함' 같은 낡은 규칙을 넘어, **① 최소 길이를 12자 이상으로 길게 설정**하고(컴퓨터는 `a!b@c#12`보다 `i_like_my_cat_rang`를 더 어려워합니다), **② 알려진 유출 비밀번호 목록과 비교**하여 쉬운 패스워드를 금지하며, **③ 복잡성을 강요하기보다 길이를 권장**하는 현대적인 정책을 도입해야 합니다.

2.  **무차별 대입 공격 방어:** **① 계정 잠금 정책**(예: 5회 실패 시 10분 잠금)과 **② IP 기반 시도 횟수 제한(Rate Limiting)**을 반드시 구현하여 자동화된 공격을 무력화해야 합니다.

3.  **다중 인증 (MFA) 도입:** 비밀번호가 유출되더라도 계정을 보호할 수 있는 가장 강력한 안전장치입니다. OTP 앱, 생체 인식 등 사용자가 **What you know(비밀번호)'** 외에 **'What you have(스마트폰)'**이나 **'What you are(지문)'**을 추가로 인증해야 합니다.

4.  **안전한 세션 관리:** 암호학적으로 안전한 난수 생성기(CSPRNG)를 통해 예측 불가능한 세션 ID를 생성하고, 모든 세션 쿠키에 `HttpOnly`, `Secure`, `SameSite=Strict` 속성을 부여하여 세션 탈취 공격을 원천적으로 방어해야 합니다.

<hr class="short-rule">