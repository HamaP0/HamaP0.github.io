---
layout: post
title: BLUEMAX NGF 방화벽 기능 통합 실습 기록
date: 2025-07-25 17:00:00 +0900
categories: NGFW
tags: [Firewall, BLUEMAX, NAT, HA]
---

BLUEMAX NGF(Next-Generation Firewall) 장비를 활용하여 네트워크 보안의 핵심 기능들을 구축하고 검증하는 통합 실습을 진행했습니다. 본 기록은 방화벽의 기본 설정부터 라우터 모드 운영, 네트워크 주소 변환(NAT), 고가용성(HA) 이중화 구성, 그리고 차세대 보안 기능 적용에 이르기까지의 전 과정을 다룹니다. 모든 과정은 물리적 장비에 직접 설정값을 입력하고 그 결과를 관찰하는 방식으로 수행되었습니다.

## 핵심 기술 1: 방화벽 기본 설정과 라우터 모드

### 학습 목표
방화벽을 네트워크의 경계에 위치시키고, 각기 다른 IP 대역을 사용하는 내부망과 외부망 간의 통신을 중개하는 L3 라우터로서의 기본 역할을 수행하도록 설정하는 것을 목표로 합니다. 정적 라우팅 설정을 통해 방화벽이 알지 못하는 목적지로의 경로를 지정하는 과정을 확인합니다.

### 주요 실습 내용
1.  콘솔(Serial) 연결을 통해 장비에 접속하고, `supermode` 진입 후 초기 관리자 계정 및 접속 IP를 설정했습니다. (`admin ip add 192.168.10.10/24`)
2.  물리적 인터페이스 `eth0`, `eth1`, `eth2` 등에 각각 내부망, 외부망 역할을 부여하고 IP 주소를 할당했습니다. (예: `eth2` 외부망 `10.10.31.150/24`, `eth0` 내부망 `192.168.25.1/24`)
3.  기본 게이트웨이(`10.10.31.254`)를 설정하여 외부 인터넷으로 나가는 기본 경로를 지정했습니다.
4.  방화벽에 직접 연결되지 않은 다수의 내부 네트워크 대역(`192.168.11.0/24`, `192.168.21.0/24` 등)으로 향하는 트래픽을 특정 게이트웨이(`10.10.31.110` 등)로 전달하도록 정적 라우팅(Static Routing) 규칙을 다수 추가했습니다.
5.  초기 통신 확인을 위해 출발지, 목적지, 서비스가 모두 'ANY'로 설정된 방화벽 허용 정책을 추가하고 `ping` 테스트를 통해 네트워크 연결성을 검증했습니다.

### 실습을 통한 핵심 연결점
정적 라우팅 규칙을 추가하기 전과 후의 `ping` 테스트 결과를 비교함으로써, 방화벽이 라우터로서 동작하기 위해서는 목적지 경로에 대한 명시적인 정보가 반드시 필요함을 확인했습니다. 라우팅 테이블에 경로가 없는 IP 대역으로는 패킷이 전달되지 않는 현상을 통해, 방화벽의 패킷 전달(Forwarding)이 라우팅 테이블 정보에 직접적으로 의존한다는 L3 통신의 기본 원리를 검증했습니다.

## 핵심 기술 2: 네트워크 주소 변환(NAT)과 정책 라우팅

### 학습 목표
내부 사설 IP 주소를 외부 공인 IP 주소로 변환하는 NAT의 동작 원리를 이해하고, 특정 조건의 트래픽을 지정된 경로로만 보내는 정책 라우팅을 설정하는 것을 목표로 합니다. `tcpdump`를 이용해 NAT 적용 시 실제 패킷 헤더가 변경되는 과정을 관찰합니다.

### 주요 실습 내용
1.  N:M 확장 변환(Port Pool) 방식의 NAT 정책을 설정했습니다. 출발지 객체로 다수의 내부 사설 IP 대역(`192.168.15.0/24`, `192.168.25.0/24`)을, 변경 후 출발지 객체로 특정 외부 공인 IP(`10.10.31.150`)를 지정했습니다.
2.  기본 게이트웨이(`10.10.31.253`) 외에, 특정 목적지(`10.10.35.251/32`)로 향하는 트래픽만 보조 게이트웨이(`10.10.31.254`)를 사용하도록 정책 라우팅 규칙을 추가했습니다.
3.  CLI에서 `tcpdump -nni eth1 host 192.168.15.1` (내부) 명령어와 `tcpdump -nni eth2 host 10.10.31.150` (외부) 명령어를 동시에 실행하여 패킷의 변화를 모니터링했습니다.

### 실습을 통한 핵심 연결점
`tcpdump` 명령어로 내부 인터페이스(eth1)와 외부 인터페이스(eth2)를 동시에 모니터링한 결과, 동일한 통신 세션임에도 불구하고 내부에서는 출발지 IP가 `192.168.15.1`로, 외부에서는 `10.10.31.150`으로 기록되는 것을 실시간으로 관찰했습니다. 이는 NAT가 단순한 논리적 개념이 아니라, 방화벽이 패킷 헤더의 주소 필드를 물리적으로 재기록(Rewrite)하는 동작임을 명확히 검증하는 과정이었습니다.

## 핵심 기술 3: 고가용성(HA) 이중화 구성

### 학습 목표
두 대의 방화벽을 Active-Active 모드로 이중화하여 한 장비에 장애가 발생하더라도 서비스 중단 없이 다른 장비가 즉시 트래픽을 처리하도록 구성하는 것을 목표로 합니다. 가상 IP(VIP)의 역할을 이해하고, 장애 발생 시 VIP 소유권이 이전되는 과정을 확인합니다.

### 주요 실습 내용
1.  Master 장비와 Slave 장비에 각각 고유 ID(`NGF-0101`, `NGF-0202`)와 우선순위(16, 1)를 부여했습니다.
2.  두 장비 간 상태 동기화를 위한 HA 전용 인터페이스(`eth3`)를 `1.1.1.1/30`, `1.1.1.2/30`으로 설정했습니다.
3.  내부망과 외부망에 각각 물리적 IP와는 별개인 가상 IP(VIP)를 설정했습니다. (내부망 VIP: `192.168.15.1/24`, 외부망 VIP: `10.10.31.150/24`)
4.  Master 장비의 외부 네트워크 케이블을 제거하여 인위적으로 장애 상황을 발생시킨 후, `ha show status` 및 `ha show vip` 명령어를 통해 VIP 소유권이 Slave 장비로 이전되었는지 확인했습니다.
5.  HA 멤버별로 서로 다른 공인 IP를 사용하도록 NAT 고급 설정을 구성했습니다. Master 장애 시, Slave의 인터넷 회선으로 대체되는 것을 확인했습니다.

### 실습을 통한 핵심 연결점
장애 발생 시, 내부 사용자 PC의 게이트웨이 설정 변경 없이도 통신이 유지되는 것을 확인했습니다. CLI 상태 정보에서 Master 장비의 우선순위(priority)가 감소하고 VIP의 `state`가 `master`에서 `backup`으로 변경되는 것을 관찰했습니다. 이를 통해 HA 구성의 핵심은 물리적 IP가 아닌 '가상 IP'이며, 서비스 연속성은 이 VIP의 소유권을 동적으로 이전함으로써 보장된다는 원리를 검증했습니다.

## 핵심 기술 4: 차세대 보안 기능 (애플리케이션 제어 및 콘텐츠 필터링)

### 학습 목표
전통적인 IP/Port 기반의 L4 방화벽을 넘어, 트래픽의 내용(Content)과 애플리케이션(L7)을 인지하여 보안 정책을 적용하는 차세대 방화벽의 핵심 기능을 확인하는 것을 목표로 합니다.

### 주요 실습 내용
1.  **애플리케이션 제어**: 방화벽 정책에 애플리케이션 객체로 'kakaotalk-base'를 등록하고 동작을 '거부(deny)'로 설정했습니다. IP/Port 기반 정책에서는 허용된 사용자임에도 카카오톡 로그인이 실패하는 것을 확인했습니다.
2.  **웹 필터**: 사용자 정의 URL 카테고리를 생성하고 `www.korea.com` 도메인을 등록했습니다. 특정 내부 IP 대역에서는 해당 사이트로의 접속을 차단하는 웹 필터 정책을 적용하고 접속 불가 상태를 관찰했습니다.
3.  **데이터 유출 방지(DLP)**: FTP 파일 전송을 통해 `DLP-test.txt` 파일 내부에 'abc'라는 문자열이 포함된 경우, 파일 전송이 차단되는 것을 확인했습니다. 데이터 필터 로그에서 해당 차단 기록을 검토했습니다.
4.  **파일 유형 제어**: SMB 프로토콜을 통해 `filetype.xlsx` 파일 전송을 시도했을 때, 파일 유형 제어 정책에 의해 차단되는 현상을 확인했습니다. 트래픽 세션 로그의 보안 기능 필드에 'FILE'이 기록된 것을 검토했습니다.

### 실습을 통한 핵심 연결점
IP 주소와 포트 번호(L3/L4)를 기반으로 하는 일반 방화벽 허용 정책이 있음에도 불구하고, 애플리케이션, URL 카테고리, 파일 내용의 문자열, 파일 고유 시그니처 등 L7 정보에 기반한 추가 보안 프로파일이 트래픽을 차단하는 것을 확인했습니다. 이는 차세대 방화벽이 패킷의 내용을 깊이 있게 검사(Deep Packet Inspection)하고, 이를 통해 더욱 세분화된 보안 제어가 가능하다는 핵심 원리를 증명하는 과정이었습니다.

## 마치며
이번 통합 실습을 통해 BLUEMAX NGF 장비의 주요 기능들을 체계적으로 검증했습니다. 인터페이스 IP 설정과 정적 라우팅을 통한 네트워크 연결성 확보, NAT 정책에 따른 패킷 IP 헤더의 실질적인 변화, 그리고 HA 구성에서 VIP를 통한 서비스 연속성 확보 원리를 관찰했습니다. 또한, 애플리케이션 및 콘텐츠 인지 기반의 차세대 보안 기능들이 기존의 L3/L4 정책과 어떻게 연계되어 동작하는지 확인하며, 이론적 지식을 실제 현상과 연결하는 과정을 완료했습니다.

