---
layout: post
title: "A02:2021 - Cryptographic Failures (암호화 실패) 분석 보고서"
date: 2025-08-26 17:00:00 +0900
categories: Projects OWASP-Top-10
---
---

### **프로젝트 2. A02:2021 - Cryptographic Failures (암호화 실패) 분석 보고서**

### **1. 취약점 개요**

   암호화 실패는 보안이라는 사슬에서 *가장 약한 고리 하나가 끊어져 전체 시스템이 붕괴되는* 모든 상황을 의미합니다. 데이터 전송 · 저장 · 사용 중 어느 한 단계에서라도 암호화가 누락되거나 취약한 방식이 사용된다면 공격자는 사용자의 계정을 탈취하고 민감 데이터를 유출하는 결정적인 발판을 마련하게 됩니다. 이는 기업의 신뢰도를 무너뜨리는 심각한 데이터 유출 사고의 직접적인 원인이 됩니다.

   본 보고서는 공격자가 ① 사용자의 인증 상태(세션)를 가로채고 ② 전송 중인 비밀번호를 엿보며 ③ 최종적으로 데이터베이스에 저장된 암호까지 해독해내는 다각적인 암호화 실패 시나리오를 증명합니다.

---

### **2. 시나리오 분석 및 재현**

#### **Part 1. [인증 상태 공격] 예측 가능한 세션 ID를 이용한 계정 하이재킹**

*   **공격 시나리오:**
   만약 로그인 후 발급되는 세션 ID가 암호학적 난수가 아닌, 예측 가능한 패턴(예: 1씩 증가)으로 생성된다면, 공격자는 다른 사용자의 세션 ID를 추측하여 인증 절차 없이 해당 계정을 탈취**세션 하이재킹**할 수 있을 것이다.

*   **공격 검증:**
   Burp Suite를 이용해 `Weak Session IDs` 페이지에 반복적으로 요청을 보낸 결과, 서버가 발급하는 `dvwaSession` 쿠키 값이 `1, 2, 3...` 순서로 순차적으로 증가하는 것을 확인했습니다. 이는 세션 ID가 예측 가능하여 보안에 매우 취약함을 의미합니다.

   ![1]({{ "/assets/images/A02_P1-1.png" | relative_url }})
   ![2]({{ "/assets/images/A02_P1-2.png" | relative_url }})
   ![3]({{ "/assets/images/A02_P1-3.png" | relative_url }})

*   **위험성 분석:**
   이 간단한 규칙을 통해 공격자는 현재 접속 중인 다른 사용자의 세션 ID를 매우 쉽게 알아낼 수 있습니다. 탈취한 세션 ID를 이용하면, 비밀번호를 몰라도 해당 사용자의 계정으로 모든 활동을 수행할 수 있게 됩니다.

>   취약한 세션 ID는 사용자의 인증 상태를 무력화시키는 심각한 위협입니다. 하지만 공격자가 세션을 가로채지 못했을 경우, 그 다음 목표는 사용자의 비밀번호 그 자체가 됩니다.

#### **Part 2. [인증 과정 공격] 암호화되지 않은 통신`HTTP` 감청으로 로그인 정보 유출**

*   **공격 시나리오:**
   만약 로그인 페이지가 암호화되지 않은 HTTP 프로토콜을 사용한다면, 동일 네트워크에 있는 공격자는 중간자 공격`MITM`을 통해 전송되는 로그인 패킷을 가로채 아이디와 비밀번호를 평문 그대로 탈취할 수 있을 것이다.

*   **공격 검증:**
   Burp Suite로 DVWA 로그인 요청 패킷을 가로채자, `password` 파라미터의 값이 어떠한 암호화도 없이 평문`letmein` 상태로 전송되는 것을 확인했습니다.

   ![password]({{ "/assets/images/A02_P2-1.png" | relative_url }})
   ![letmein]({{ "/assets/images/A02_P2-2.png" | relative_url }})

*   **위험성 분석:**
   특히 보안이 취약한 공용 Wi-Fi 환경에서, 공격자는 이처럼 암호화되지 않은 통신을 엿듣는 것만으로 사용자의 계정 정보를 손쉽게 훔칠 수 있습니다. 이는 가장 고전적이면서도 여전히 효과적인 정보 탈취 기법입니다.

>   전송 과정이 TLS로 안전하게 암호화되어 있더라도 안심할 수 없습니다. 공격자의 마지막 목표는 서버에 저장된 최후의 보루, 바로 데이터베이스입니다.

#### **Part 3. [저장 데이터 공격] 유출된 DB에서 취약한 MD5 해시 복호화**

*   **공격 시나리오:**
   만약 데이터베이스에 저장된 비밀번호가 현재는 사용이 권고되지 않는 취약한 해시 알고리즘`MD5`으로 암호화되어 있다면, 공격자는 데이터베이스 유출 시 레인보우 테이블 등을 이용해 해시 값을 단시간 내에 원본 비밀번호로 복원할 수 있을 것이다.

*   **공격 검증:**
   SQL Injection 공격을 통해 탈취한 `users` 테이블의 사용자 정보를 확인한 결과, `password` 컬럼의 값(`5f4dcc3b5aa7...`)이 현재는 보안 결함으로 인해 절대 사용해서는 안 되는 **MD5** 해시 알고리즘으로 생성된 값임을 확인했습니다.

   ![' UNION SELECT user, password FROM users#]({{ "/assets/images/A02_P3-1.png" | relative_url }})

*   **위험성 분석:**
   MD5는 충돌 가능성이 높고 계산 속도가 너무 빨라 현대적인 무차별 대입 공격에 매우 취약합니다. 만약 이 데이터베이스가 유출된다면, MD5로 저장된 비밀번호는 사실상 평문으로 저장한 것과 별 차이가 없을 정도로 위험합니다.
    
---

### **3. 원인 및 해결 방안**

*   **원인: 데이터 생명주기를 고려하지 않은 단편적인 보안**

   이 세 가지 문제의 공통적인 원인은 데이터의 전체 생명주기**전송 중 · 저장 시 · 사용 중**를 종합적으로 고려하지 않고, 각 단계를 단편적으로만 바라보았기 때문입니다. 개발자는 '어떻게든 암호화만 하면 된다'고 생각했지만, 각 단계의 특성에 맞는 적절한 암호화 기술을 적용하지 않아 모든 방어선이 뚫렸습니다.

*   **해결 방안: 데이터 생명주기 전반에 걸친 심층 방어 전략**

   안전한 암호화는 데이터가 거치는 모든 단계에 적합한, 다층적인 보안 장치를 마련하는 것에서 시작합니다.

   ![보안 규칙]({{ "/assets/images/A02_table.png" | relative_url }})

1.  **[데이터 전송 시] TLS/SSL을 통한 채널 암호화:**
   모든 통신은 **HTTPS(TLS)**를 강제하여, 클라이언트와 서버 사이에 안전한 암호화 터널을 만들어야 합니다. 이를 통해 Part 2에서 발생한 중간자 공격을 원천적으로 차단할 수 있습니다.

2.  **[데이터 저장 시] 최신 해시 알고리즘 적용:**
   비밀번호와 같은 민감 정보는 반드시 **Bcrypt · scrypt · Argon2**와 같은 최신 해시 알고리즘으로 저장해야 합니다. 이 알고리즘들은 의도적으로 계산 속도를 느리게 설계하고, **솔트Salt**와 **키 스트레칭Key Stretching**을 통해 Part 3에서 발생한 무차별 대입 공격Brute-force을 효과적으로 무력화합니다.

3.  **[데이터 사용 시] 암호학적으로 안전한 토큰 생성:**
   세션 ID를 포함한 모든 보안 토큰은 반드시 예측이 불가능하도록, **암호학적으로 안전한 의사 난수 생성기CSPRNG**를 통해 생성되어야 합니다. 이는 Part 1에서 발생한 세션 하이재킹 공격을 근본적으로 방어합니다.

---

### **4. 시큐어 코딩 (방어자의 관점): 코드 레벨 분석**

**분석 대상:** DVWA - Weak Session IDs (Part 1 시나리오의 원인 코드)

#### **취약한 코드 분석 (Low Level)**

   ![]({{ "/assets/images/A02_S-1.png" | relative_url }})  

   *   **코드 분석:** 이 코드는 **`$cookie_value`** 라는 변수를 **`++`** 연산자를 통해 1씩 순차적으로 증가시키고 있습니다. 이처럼 예측 가능한 로직으로 세션 ID를 생성하는 것은, 공격자에게 다음 사용자의 세션 ID를 추측할 수 있는 명백한 단서를 제공하는 치명적인 실수입니다.

#### **안전한 코드 분석 (Impossible Level)**

   ![]({{ "/assets/images/A02_S-2.png" | relative_url }})  

   *   **코드 분석:** 안전한 코드는 예측 가능한 연산을 완전히 배제하고 다층적인 방어 로직을 적용합니다. 첫째로 `mt_rand()` (난수) · `time()` (현재 시간) · 고정 문자열`Salt`을 조합하여 예측 불가능한 입력값을 만들고 이를 **`sha1()`** 함수로 해싱하여 추측이 불가능한 세션 ID를 생성합니다. 둘째로 `setcookie` 함수의 **`Secure`** `true` 와 **`HttpOnly`** `true` 옵션을 활성화하여 각각 중간자 공격(MitM)을 통한 쿠키 탈취와 XSS 공격을 통한 세션 하이재킹을 원천적으로 차단합니다.

#### **핵심 방어 원리**

   결론적으로 인증 토큰(세션 ID)의 핵심 방어 원리는 **예측 불가능성** 과 **보호된 전송** 입니다. 모든 보안 토큰은 반드시 암호학적으로 안전한 난수 생성기를 통해 만들어져야 하며, Secure 및 HttpOnly 같은 보안 플래그를 적용하여 전송 및 보관 과정에서의 탈취 위협으로부터 보호되어야 합니다.

<hr class="short-rule">