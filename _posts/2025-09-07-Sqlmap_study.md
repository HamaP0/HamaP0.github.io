---
layout: post
title: "Sqlmap 공부"
date: 2025-09-07 17:00:00 +0900
categories: [해킹 툴]
---

### 1. Sqlmap 개요

Sqlmap은 SQL Injection 취약점을 탐지하고 공격을 자동화하는 오픈소스 도구이다. 명령 줄 인터페이스(CLI) 기반으로 동작하며 데이터베이스 정보를 탈취하거나 서버의 운영체제 명령어까지 실행할 수 있는 강력한 기능을 갖추고 있다.

수동으로 하려면 매우 오래 걸리는 Blind SQL Injection과 같은 공격을 자동화하여 공격 시간을 획기적으로 단축시킨다.

---

### 2. 기본 사용법 및 옵션

#### **기본 스캔**
`-u` 옵션으로 취약점을 점검할 URL을 지정한다. Sqlmap이 테스트할 파라미터를 URL에 포함해야 한다.
```bash
sqlmap -u "http://[Target IP]/vulnerabilities/sqli/?id=1&Submit=Submit#"
```

#### **주요 옵션**
*   **--cookie="[COOKIE]"**: 인증이 필요한 페이지를 점검할 때 사용한다. 브라우저에서 복사한 쿠키 값을 입력한다.
*   **--dbs**: 공격 가능한 데이터베이스의 목록을 보여준다.
*   **-D [DB_NAME] --tables**: 특정 데이터베이스에 포함된 테이블 목록을 보여준다.
*   **-D [DB_NAME] -T [TABLE_NAME] --columns**: 특정 테이블에 포함된 컬럼 목록을 보여준다.
*   **-D [DB_NAME] -T [TABLE_NAME] -C [COLUMN_NAME] --dump**: 특정 컬럼의 데이터를 모두 추출하여 보여준다.
*   **--batch**: 스캔 과정에서 Sqlmap이 묻는 모든 질문에 기본값(Y)으로 자동 응답한다.

---

### 3. 사용 예시

Target 서버 `192.9.200.11`의 DVWA SQL Injection 페이지를 대상으로 데이터베이스 목록을 확인하고 사용자 정보를 탈취했다.

#### **데이터베이스 목록 확인**
```bash
sqlmap -u "http://192.9.200.11/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie="security=low; PHPSESSID=..." --dbs
```
[여기에 데이터베이스 목록이 출력된 결과 이미지 삽입]

#### **`users` 테이블 데이터 탈취**
위에서 확인한 `dvwa` 데이터베이스의 `users` 테이블에서 `user`, `password` 컬럼의 내용을 탈취한다.
```bash
sqlmap -u "..." --cookie="..." -D dvwa -T users -C user,password --dump
```
[여기에 users 테이블의 내용이 출력된 결과 이미지 삽입]

---

### 4. 파일 시스템 접근 및 OS 명령어 실행

데이터베이스 사용자가 충분한 권한(예: FILE 권한)을 가졌을 때 Sqlmap은 파일 시스템에 접근하거나 운영체제 쉘을 획득하는 기능을 제공한다.

#### **파일 시스템 접근 `--file-read`**
`--file-read` 옵션을 사용하면 서버의 로컬 파일을 직접 읽을 수 있다. 리눅스 시스템의 사용자 정보를 담고 있는 `/etc/passwd` 파일을 읽는 예시이다.
```bash
sqlmap -u "..." --cookie="..." --file-read "/etc/passwd" --batch
```

#### **운영체제 쉘 획득 (`--os-shell`)**
`--os-shell` 옵션은 Sqlmap의 가장 강력한 기능 중 하나로, 성공 시 대상 서버의 운영체제 쉘을 획득하여 직접 명령을 내릴 수 있다. Sqlmap은 이 과정에서 웹 서버의 쓰기 가능한 경로에 명령어 실행을 위한 작은 스크립트(Stager)를 업로드한다.
```bash
sqlmap -u "..." --cookie="..." --os-shell
```
[여기에 --os-shell 획득 이미지 삽입]

`os-shell` 세션에 성공적으로 진입하면 `whoami`, `ls -l` 등 원하는 시스템 명령어를 실행하여 서버를 직접 제어할 수 있다.

<hr class="short-rule">





### 시각 자료(이미지) 제작을 위한 스크립트

#### **이미지 1 제작 (데이터베이스 목록)**

1.  터미널에 `--dbs` 옵션을 포함한 첫 번째 `sqlmap` 명령어를 실행합니다.
2.  Sqlmap이 실행되면서 여러 로그가 출력되다가, 마지막 부분에 `available databases [n]`와 함께 데이터베이스 이름 목록(`dvwa`, `information_schema` 등)이 출력됩니다.
3.  이 데이터베이스 목록이 포함된 결과 화면을 스크린샷으로 찍습니다.
4.  이미지에서 `available databases` 제목과 그 아래 데이터베이스 이름 목록 전체에 하이라이트를 적용하여 저장합니다.

#### **이미지 2 제작 (users 테이블 덤프)**

1.  터미널에 `--dump` 옵션을 포함한 두 번째 `sqlmap` 명령어를 실행합니다.
2.  Sqlmap이 데이터를 추출한 후, 위 예시 결과처럼 표 형태로 `users` 테이블의 내용을 출력합니다.
3.  `user`와 `password` 컬럼 및 데이터가 보이는 표 전체를 포함하여 스크린샷을 찍습니다.
4.  이미지에서 출력된 표 전체에 하이라이트를 적용하여 저장합니다.

#### **이미지 3 제작 (--os-shell 획득)**

1.  터미널에 `--os-shell` 옵션을 포함한 `sqlmap` 명령어를 실행합니다. `--batch` 옵션은 제외하여 진행 과정을 확인합니다.
2.  Sqlmap이 웹 서버의 언어(PHP, ASP 등)와 쓰기 가능한 디렉터리 경로를 물어봅니다. 대부분의 경우 기본값을 그대로 사용하면 되므로 Enter 키를 누릅니다.
3.  성공적으로 스크립트(Stager)가 업로드되면, `os-shell>` 이라는 새로운 프롬프트가 나타납니다.
4.  새로운 프롬프트에서 `whoami` 또는 `id` 명령어를 입력하여 `www-data`와 같은 결과가 출력되는 것을 보여줍니다.
5.  `--os-shell` 명령어 실행부터 `os-shell>` 프롬프트에서 명령어를 실행한 결과까지 모두 포함된 터미널 화면을 스크린샷으로 찍습니다.
6.  이미지 편집 프로그램을 사용하여 스크린샷을 엽니다.
7.  두 부분에 하이라이트를 적용하여 원인과 결과를 명확히 보여줍니다.
    *   **원인:** `--os-shell` 옵션을 사용한 명령어 라인
    *   **결과:** 획득한 `os-shell>` 프롬프트와 그 안에서 실행한 `whoami` 명령어의 결과
8.  수정된 이미지를 저장하여 게시글에 삽입합니다.