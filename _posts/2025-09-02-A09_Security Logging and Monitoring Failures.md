---
layout: post
title: "A09:2021 - Security Logging and Monitoring Failures (보안 로깅 및 모니터링 실패) 분석 보고서"
date: 2025-09-02 17:00:00 +0900
categories: Projects OWASP-Top-10
---
---

### **프로젝트 9. (Masterpiece) A09:2021 - Security Logging and Monitoring Failures (보안 로깅 및 모니터링 실패) 분석 보고서**

#### **1. 취약점 개요**

'보안 로깅 및 모니터링 실패'를 이해하기 위해, 시스템을 하나의 집에 비유해 보았습니다. 만약 집에 침입이 발생했을 때 CCTV가 없거나, 녹화는 되지만 아무도 그 영상을 확인하지 않는다면 어떻게 될까요? 침입 사실 자체를 모르거나, 알아도 범인의 행적을 파악하는 데 필요한 가장 기본적인 단서가 사라지는 문제입니다.

이와 같이, '로깅 및 모니터링 실패'는 시스템에 발생한 보안 이벤트를 기록하지 않거나, 기록하더라도 그 의미를 분석하여 위협으로 인지하지 못하는 모든 상태를 의미합니다. 이번 분석은 공격 성공 '이후'에 서버에 어떤 흔적이 남는지(또는 남지 않는지)를 추적하는 '보안 분석가'의 관점에서 진행했습니다.

---

#### **2. 시나리오 분석 및 재현: 기록되지 않은 위협의 추적**

**Part 1. 불충분한 이벤트 로깅**

*   **가설 설정:**
    자동화 도구를 이용한 SQL Injection 공격은 다수의 비정상적인 요청을 발생시키므로, 웹 서버 로그에 해당 활동을 위협으로 식별할 수 있는 명확한 기록이 남을 것이라 가정했다.

*   **분석 및 검증:**
    SQL Injection 자동화 도구 `sqlmap`을 실행함과 동시에, SSH로 접속한 서버 터미널에서 `tail -f` 명령어로 Apache 접근 로그를 실시간으로 모니터링했습니다다.

   ![monitoring](/assets/images/A09_P1-1.png)

    분석 결과, 공격은 성공적으로 수행되었으나 서버의 `access.log`는 해당 행위를 위협으로 식별할 수 있는 정보를 포함하지 않았습니다. 로그에는 HTTP 요청에 대한 기본적인 정보(IP, 시간, 요청 URL, 응답 코드)만 기록될 뿐, 해당 요청이 프로그램에 어떤 영향을 미쳤는지에 대한 **'보안 관점의 의미'**가 전혀 담겨있지 않았습니다. 표준 웹 서버 접근 로그는 트래픽 분석을 주 목적으로 설계되었기에, 실패한 로그인 시도, 입력값 검증 실패 등  **프로그램 내부에서 일어나는 중요한 보안 사건**을 기록하지 못하는 한계가 명확했습니다.

**Part 2. 의미를 알 수 없는 기록**

*   **가설 설정:**
    로그가 보안 이벤트로 분류되지는 않더라도, 사후 분석을 위해 로그 파일을 상세히 검토하면 공격에 사용된 악성 페이로드를 식별할 수 있을 것이라 가정했다.

*   **분석 및 검증:**
    공격이 완료된 후, `grep` 명령어를 통해 `access.log` 파일에서 `UNION` 키워드가 포함된 로그를 필터링했습니다. 그 결과, `sqlmap`이 정보 탈취를 위해 사용한 `UNION` 기반의 공격 코드가 URL 인코딩된 상태로 로그에 기록된 것을 확인했습니다.

   ![UNION](/assets/images/A09_P2-1.png)

    해당 로그는 공격이 있었다는 사실을 나중에 증명하는 단서는 될 수 있으나, 효과적인 감시 시스템이라고 부르기에는 부족합니다. 로그 자체에 위험 등급이나 이벤트의 종류 같은 **'분류 정보'**가 없기 때문입니다. 따라서 자동화된 시스템이 대규모 로그 속에서 이 특정 항목을 실시간 위협으로 찾아내 경고를 보내는 것은 사실상 불가능합니다. 이는 단순히 '기록'하는 것과 위협을 '탐지'하는 것은 다른 문제임을 보여주는 사례입니다.

**Part 3. 증거 인멸 시도와 운영체제의 방어**

*   **가설 설정:**
    공격자가 시스템 제어권을 획득한 경우, 자신의 공격 흔적을 제거하기 위해 로그 파일을 직접 위변조하거나 삭제할 수 있을 것이라 가정했다.

*   **분석 및 검증:**
    먼저, 공격자가 웹 취약점을 통해 획득한 낮은 권한의 계정을 가정하여, SSH로 접속한 일반 사용자(`d`) 권한으로 로그 파일 삭제를 시도했습니다. `rm` 명령어 실행 시, "허가 거부" 메시지와 함께 작업이 실패했습니다.

    `[여기에 일반 계정으로 'rm /var/log/apache2/access.log' 실행 시 '허가 거부' 메시지가 출력된 터미널 스크린샷 삽입]`
   ![denied](/assets/images/A09_P3-1.png)


    `ls -l` 명령어로 확인한 결과, 로그 파일의 소유자는 `root`이며 일반 사용자는 쓰기 권한이 없었습니다. 이는 운영체제의 파일 권한 설정이 1차적인 방어선 역할을 해준다는 것을 의미합니다.

    다음으로, 공격자가 '권한 상승(Privilege Escalation)' 공격에 성공하여 시스템 최고 관리자(`root`) 권한을 획득한 상황을 가정했습니다. `sudo` 명령어를 통해 로그 파일 삭제를 시도하자 성공적으로 파일이 제거되었습니다.

    `[여기에 'sudo rm ...' 명령어로 access.log가 삭제된 후, 'ls -l' 명령어로 파일이 사라진 것을 확인하는 터미널 스크린샷 삽입]`
   ![rm log](/assets/images/A09_P3-1.png)

    이 결과는 서버 내부에만 로그를 저장하는 방식의 근본적인 한계를 보여줍니다. 공격이 고도화되어 관리자 권한까지 탈취당할 경우, 모든 범죄의 증거가 사라질 위험이 있습니다. 따라서 로그 데이터가 **위조되지 않았다는 점(무결성)**과 **필요할 때 언제든 볼 수 있다는 점(가용성)**을 보장하기 위한 별도의 안전장치가 반드시 필요하다는 결론을 얻었습니다.

---

#### **4. 효과적인 로깅 및 모니터링 체계 구축**

이번 분석을 통해 도출된 문제점들은 개별 시스템의 설정을 넘어, 체계적인 방어 계획을 통해 해결해야 합니다. 효과적인 로깅 및 모니터링 체계는 다음의 요소들을 포함해야 합니다.

`[여기에 Part 4 가이드에 따라 직접 그린 SIEM 아키텍처 다이어그램 삽입]`
   ![SEIM 아키텍처](/assets/images/A09_SEIM.png)

1.  **무엇을 기록할 것인가 (로깅 범위):** 먼저 어떤 활동을 기록할지 명확히 정해야 합니다. 인증 성공/실패, 접근 권한이 없는 페이지 시도, 중요한 기능 실행 등 보안과 관련된 모든 사건은 반드시 기록해야 하며, 로그에는 '누가, 언제, 어디서, 무엇을, 어떻게, 결과는 어땠는지'가 명확히 포함되어야 합니다.

2.  **로그 무결성 보장:** Part 3에서 확인된 삭제 위협에 대응하기 위해, 모든 로그는 생성되는 즉시 **별도의 중앙 로그 관리 서버로 실시간 전송**해야 합니다. 이 서버는 **한 번 기록된 내용은 수정하거나 삭제할 수 없도록(쓰기 전용)** 설정하여 로그의 위변조를 원천적으로 막아야 합니다.

3.  **중앙화 및 상관분석 (SIEM):** 분산된 모든 시스템의 로그(서버, 네트워크 장비 등)를 **SIEM**이라는 통합 보안 관제 시스템으로 모아야 합니다. SIEM은 서로 다른 종류의 로그들을 **하나의 통일된 양식으로 변환(정규화)**하고, 미리 정해진 규칙에 따라 연관성을 분석합니다. 예를 들어, **'웹 서버에서 SQL Injection 의심 로그가 발생하고 10초 안에, 똑같은 IP 주소에서 DB 서버로 대량의 데이터를 요청했다'** 와 같은 복합적인 상황을 **'상관 분석'**하여 하나의 로그만 봐서는 알 수 없는 지능적인 위협을 찾아내고 실시간 경고를 보냅니다.

4.  **정기적인 검토 및 훈련:** 구축된 시스템은 보안 전문가가 지속적으로 지켜봐야 합니다. 또한, 정기적으로 모의 해킹 훈련을 수행하여, 만들어 둔 탐지 규칙이 실제 공격 상황에서 잘 동작하는지 검증하고, 경고 발생 시 어떻게 행동해야 하는지 정해진 **대응 절차(플레이북)를 익히는 과정**이 필수적입니다.

---