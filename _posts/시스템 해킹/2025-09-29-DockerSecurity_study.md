---
layout: post
title: "Docker 공부"
date: 2025-09-29 17:00:00 +0900
categories: [시스템 해킹]
---

### 1. 개요

Docker 보안은 컨테이너 이미지 · 실행 중인 컨테이너 · 컨테이너를 실행하는 호스트 시스템의 보안을 확보하는 활동이다.

컨테이너는 호스트 운영체제의 커널을 공유하기 때문에 가상 머신(VM)과는 다른 보안 모델을 가진다. 하나의 컨테이너가 해킹당하면 호스트 시스템 전체와 다른 컨테이너까지 위험에 처할 수 있다.

---

### 2. 주요 공격 표면 (Attack Surfaces)

Docker 환경의 보안은 크게 세 가지 영역으로 나눌 수 있다.

#### ***1. 이미지 보안 (공급망 보안)***
*   **취약점:** 컨테이너의 기반이 되는 이미지(Base Image) 자체에 오래된 버전의 라이브러리 등 알려진 취약점(CVE)이 포함되어 있을 수 있다. 이는 소프트웨어 공급망 공격의 주요 경로가 된다.
*   **대응:** `Trivy`, `Docker Scout` 와 같은 스캐닝 도구를 사용해 이미지를 빌드하거나 배포하기 전에 취약점을 점검해야 한다.

#### ***2. 컨테이너 런타임 보안***
*   **취약점 1: Root 사용자로 실행:** 컨테이너를 기본값(root)으로 실행하면 컨테이너 내부에서 root 권한을 가진 공격자가 탈출(Escape)하여 호스트 시스템의 root 권한까지 획득할 위험이 매우 커진다.
*   **대응 1:** 최소 권한 원칙에 따라 Dockerfile에서 일반 사용자 계정을 생성하고 `USER` 지시어를 통해 해당 사용자로 컨테이너를 실행해야 한다.

*   **취약점 2: 민감한 정보 노출:*** Dockerfile이나 환경 변수에 API 키, 비밀번호 같은 민감 정보를 하드코딩하면 이미지 분석을 통해 쉽게 유출될 수 있다.
*   **대응 2:** Docker secrets나 외부 볼륨 마운트와 같은 안전한 방법으로 민감 정보를 컨테이너에 전달해야 한다.

#### ***3. 호스트 보안***
*   **취약점: Docker Daemon Socket 노출:** `/var/run/docker.sock` 파일은 Docker API와 통신하는 유닉스 소켓이다. 만약 컨테이너가 이 소켓을 마운트(`-v /var/run/docker.sock:/var/run/docker.sock`)하면 컨테이너 내부에서 호스트의 Docker를 제어할 수 있게 된다. 이는 사실상 호스트의 root 권한을 넘겨주는 것과 같다.
*   **대응:** 특별한 이유가 없다면 절대 `docker.sock` 파일을 컨테이너에 마운트해서는 안 된다.

<hr class="short-rule">