---
layout: post
title: "A04:2021 - Insecure Design (안전하지 않은 설계) 분석 보고서"
date: 2025-08-28 17:00:00 +0900
categories: [OWASP Top 10]
---
---

### ***프로젝트 4. A04:2021 - Insecure Design (안전하지 않은 설계) 분석 보고서***

### 1. 취약점 개요

   안전하지 않은 설계는 '튼튼한 자물쇠를 설치했지만 그 자물쇠를 허술한 나무문에 다는 것'과 같은 구조적 결함입니다. 이는 단순 코드 오류를 넘어 기획 단계에서부터 '공격자가 이 기능을 어떻게 악용할 수 있을까?'라는 위협 모델링을 간과했을 때 발생합니다. 아무리 코드를 잘 짜더라도 설계 자체가 취약하면 시스템은 근본적인 위험에 노출됩니다. 이는 예측 가능한 공격에 무방비 상태가 되어 비즈니스 로직을 파괴하거나 서버 전체를 장악당하는 심각한 결과로 이어집니다.

   본 보고서는 공격자가 ① 로그인 시도 제한이 없는 설계 결함으로 계정을 탈취하고 ② 최종적으로 파일 업로드 기능의 설계 허점을 통해 서버 제어권을 획득하는 단계적인 시스템 장악 시나리오를 증명합니다.


---

### 2. 시나리오 분석 및 재현

#### ***Part 1. [계정 탈취] 로그인 시도 횟수 제한이 없는 설계 결함 공격***

*   ***공격 시나리오:***
   로그인 기능 설계 시 '로그인 시도 횟수 제한'이나 '계정 잠금'과 같은 필수적인 방어 로직이 없다면 공격자는 자동화된 도구를 이용해 무한히 비밀번호를 추측하여 결국 계정을 탈취할 수 있을 것이다.

*   ***공격 검증:***
   Burp Suite Intruder를 사용하여 로그인 페이지에 무차별 대입 공격을 수행했습니다. 서버는 수많은 로그인 시도에도 어떠한 제재 조치도 취하지 않았습니다. 정답과 오답에 따른 서버 응답의 `Length` 값 차이를 분석한 결과, 정답 `password`일 때만 응답 크기가 `5072`로 다른 것을 확인하여 최종적으로 실제 비밀번호를 알아낼 수 있었습니다.

   ![Welcome](/assets/images/A04_P1-1.png)
   ![incorrect](/assets/images/A04_P1-2.png)


*   ***위험성 분석:***
   이 설계 결함은 사용자 계정 정보가 탈취되는 직접적인 원인이 됩니다. 공격자는 탈취한 계정으로 다른 사용자의 개인정보를 훔쳐보거나 만약 관리자 계정일 경우 시스템 전체를 장악할 수 있는 발판을 마련하게 됩니다.

>  성공적으로 계정을 탈취했지만 이는 시작에 불과합니다. 공격자의 최종 목표는 시스템 자체를 장악하는 것입니다. 이를 위해 가장 많이 사용되는 방법은 서버 내부에 악성 파일을 업로드하는 것입니다.

#### ***Part 2. [서버 장악] 업로드 파일 검증이 없는 설계 결함을 이용한 웹쉘 업로드***

*   ***공격 시나리오:***
   만약 파일 업로드 기능이 '사용자는 이미지 파일만 업로드할 것이다'라는 안일한 가정하에 설계되어 파일의 확장자나 내용을 검증하지 않는다면 공격자는 실행 가능한 악성 스크립트(웹쉘)를 업로드하여 서버를 직접 제어할 수 있을 것이다.

*   ***공격 검증:***
   서버 정보를 출력하는 간단한 PHP 코드`phpinfo()`가 포함된 `shell.php` 파일을 업로드하자 아무런 검증 절차 없이 즉시 업로드에 성공했습니다. 해당 파일이 업로드된 경로로 직접 접근하자 `phpinfo()` 정보가 출력되는 것을 확인했습니다. 이는 서버가 파일의 내용 검증 없이 저장을 허용하고 심지어 누구나 접근하여 실행할 수 있도록 설계되었음을 의미합니다.

   ![upload](/assets/images/A04_P3-1.png)
   ![phpinfo](/assets/images/A04_P3-2.png)

*   ***위험성 분석:***
   웹쉘 업로드 성공은 사실상 서버의 열쇠를 공격자에게 넘겨준 것과 같습니다. 공격자는 이 웹쉘을 통해 데이터베이스 정보를 모두 유출하거나 서버를 인질로 삼아 랜섬웨어 공격을 수행하는 등 상상할 수 있는 최악의 공격을 할 수 있게 됩니다.

---

### 3. 원인 및 해결 방안

*   ***원인: 위협 모델링의 부재***

   이 문제들의 근본적인 원인은 개발 초기 설계 단계에서 '만약 누군가 이 기능을 악의적으로 사용한다면?'이라는 질문 즉, **`위협 모델링`**을 수행하지 않았기 때문입니다. 로그인과 파일 업로드 기능 모두 정상적인 사용자 흐름만 고려하여 설계되었고 공격자가 시도할 수 있는 다양한 공격 시나리오는 설계에서 완전히 누락되었습니다.

*   ***해결 방안: 설계 단계의 보안 강화 `Shift Left`***

   가장 효과적인 해결 방안은 코드를 작성하기 전에 설계 단계에서부터 보안을 우선적으로 고려하는 
   `Shift Left` 접근법을 도입하는 것입니다.
   *   **로그인 기능:** 설계 시 `무차별 대입 공격` 위협을 예측하고 '로그인 시도 횟수 제한'과 '계정 잠금' 기능을 필수 요구사항으로 반영해야 합니다.
   *   **파일 업로드 기능:** 설계 시 `웹쉘 업로드` 위협을 예측하고 '업로드 폴더 실행 권한 제거' · '파일 확장자 화이트리스트 검증' · '파일 내용 검사'와 같은 강력한 보안 규칙을 설계에 포함해야 합니다.

---

### 4. 시큐어 코딩: 코드 레벨 분석

***분석 대상:*** DVWA - File Upload

#### ***취약한 코드 분석 Low Level***

   ![]({{ "/assets/images/A04_S-1.png" | relative_url }})

   *   ***코드 분석:*** 이 코드는 업로드된 파일의 임시 경로`$_FILES['uploaded']['tmp_name']`를 받아 어떠한 종류의 검증도 수행하지 않고 `move_uploaded_file` 함수를 통해 서버에 그대로 저장하고 있습니다. 파일의 확장자 · 내용(MIME 타입) · 크기 등을 전혀 확인하지 않는 이 로직은 공격자가 악성 웹쉘`cmd.php`을 무방비 상태인 서버에 업로드하여 시스템 전체를 장악할 수 있도록 허용하는 치명적인 취약점입니다.

#### ***안전한 코드 분석 Impossible Level***

   ![]({{ "/assets/images/A04_S-2.png" | relative_url }})  

   *   ***코드 분석:*** 안전한 코드는 '모든 사용자 입력은 잠재적 위협'이라는 **제로 트러스트`Zero Trust`** 원칙에 따라 다층적인 방어 설계를 적용했습니다. ① 파일 확장자를 화이트리스트`jpg` · `jpeg` · `png` 기반으로 엄격히 제한하고 ② 파일 크기와 MIME 타입을 검증하며 ③ `getimagesize()` 함수로 파일의 실제 내용이 정말 이미지인지 확인하여 위장된 악성 파일을 차단합니다. 또한, 단순히 파일을 이동시키는 것이 아니라 이미지를 새로 생성`re-encoding`하여 파일 내에 숨겨진 악성코드를 제거하고 파일명 또한 **랜덤화**하여 2차 공격의 가능성을 최소화합니다.

#### ***핵심 방어 원리***

   결론적으로 안전한 설계의 핵심은 **`위협 모델링`** 입니다. 개발 초기 단계부터 '공격자가 이 기능을 어떻게 악용할 수 있을까?'를 먼저 질문하고 그에 대한 방어 로직(입력값 검증 · 권한 제어 등)을 설계 단계에서부터 반영해야 합니다.

<hr class="short-rule">